{
  "rules": {
    "users": {
      "$uid": {
        ".read": "auth != null && ($uid === auth.uid || root.child('sharedAccess').child($uid).child(auth.uid).exists())",
        ".write": "auth != null && ($uid === auth.uid || root.child('sharedAccess').child($uid).child(auth.uid).exists())"
      }
    },
    "sharedAccess": {
      "$ownerId": {
        "$guestId": {
          ".read": "auth != null && auth.uid === $guestId",
          ".write": "auth != null && (auth.uid === $ownerId || auth.uid === $guestId)"
        }
      }
    },
    "publicBooks": {
      "$bookId": {
        ".read": true,
        ".write": true
      }
    }
  }
}